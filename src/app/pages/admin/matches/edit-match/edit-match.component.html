<div class="row">
  <div class="col-sm-12">
    <nb-card [nbSpinner]="isLoading" nbSpinnerStatus="primary">

      <nb-card-header>
        <button [routerLink]="['/pages/admin/matches']" class="close float-left mr-3">
          <i class="icon ion-ios-arrow-back fs-larger"></i>
        </button>
        <h2>Edit '{{match?.title}}'</h2>
      </nb-card-header>

      <nb-card-body>

        <form novalidate="" class="ng-touched ng-dirty ng-valid form" [formGroup]="form">

          <!-- Title -->
          <div class="form-group group d-flex flex-column"
               [ngClass]="{ 'error' : title.invalid && (title.dirty || title.touched) }">
            <label for="title">Match Title*</label>
            <input fullwidth id="title" name="title" nbinput formControlName="title" type="text" ng-reflect-name="title" class="input-full-width input-md ng-dirty ng-valid ng-touched" required>
            <small class="text-danger" *ngIf="title.hasError('required') && (title.dirty || title.touched)">Match title is required</small>
          </div>

          <!-- Date & Place -->
          <div class="row">

            <!-- Date -->
            <div class="form-group group d-flex flex-column col-sm-6"
                 [ngClass]="{ 'error' : date.invalid && (date.dirty || date.touched) }">
              <label for="title">Match Date*</label>
              <div class="calendar">

                <input
                  [owlDateTimeTrigger]="dt"
                  [owlDateTime]="dt"
                  [min]="now"
                  id="date" name="date" formControlName="date" ng-reflect-name="date"
                  class="input-full-width input-md ng-dirty ng-valid ng-touched" required>

                <owl-date-time
                  autoClose
                  dataType="string"
                  pickerMode="dialog"
                  #dt>
                </owl-date-time>

                <div class="buttons">
                  <button type="button"><i class="icon ion-ios-calendar"></i></button>
                </div>

              </div>
              <small class="text-danger" *ngIf="date.hasError('required') && (date.dirty || date.touched)">Date is required</small>
            </div>

            <!-- Place -->
            <div class="form-group group d-flex flex-column col-sm-6"
                 [ngClass]="{ 'error' : place.invalid && (place.dirty || place.touched) }">
              <label for="title">Match Place*</label>
              <ng-select
                #placeID
                [multiple]="false"
                [closeOnSelect]="true"
                bindLabel="name"
                bindValue="_id"
                id="place" name="place" formControlName="place" ng-reflect-name="place" class="ng-select-input-custom flex-grow-1">
              </ng-select>
              <small class="text-danger" *ngIf="place.hasError('required') && (place.dirty || place.touched)">Place is required</small>
            </div>
          </div>

          <hr>

          <!-- Enrollment -->
          <div class="row">

            <!-- Enrollment Opens -->
            <div class="form-group group d-flex flex-column col-sm-5"
                 [ngClass]="{ 'error' : enrollmentOpens.invalid && (enrollmentOpens.dirty || enrollmentOpens.touched), 'disabled' : !date.value }">
              <label for="enrollmentOpens">Enrollment Opens</label>
              <div class="calendar">

                <input
                  [owlDateTimeTrigger]="enrollmentOpensODT"
                  [owlDateTime]="enrollmentOpensODT"
                  [min]="match?.enrollment?.enrollmentOpens"
                  [max]="enrollmentCloses.value"
                  id="enrollmentOpens" name="enrollmentOpens" formControlName="enrollmentOpens" ng-reflect-name="enrollmentOpens"
                  class="input-full-width input-md ng-dirty ng-valid ng-touched" required>

                <owl-date-time
                  autoClose
                  dataType="string"
                  pickerMode="dialog"
                  #enrollmentOpensODT>
                </owl-date-time>

                <div class="buttons">
                  <button type="button"><i class="icon ion-ios-calendar"></i></button>
                </div>

              </div>
              <small class="text-danger" *ngIf="enrollmentOpens.invalid">This date is invalid</small>
            </div>

            <!-- Enrollment Closes -->
            <div class="form-group group d-flex flex-column col-sm-5"
                 [ngClass]="{ 'error' : enrollmentCloses.invalid && (enrollmentCloses.dirty || enrollmentCloses.touched), 'disabled' : !date.value }">
              <label for="enrollmentCloses">Enrollment Closes</label>
              <div class="calendar">

                <input
                  [owlDateTimeTrigger]="enrollmentClosesODT"
                  [owlDateTime]="enrollmentClosesODT"
                  [min]="enrollmentOpens.value"
                  [max]="date.value"
                  id="enrollmentCloses" name="enrollmentCloses" formControlName="enrollmentCloses" ng-reflect-name="enrollmentCloses"
                  class="input-full-width input-md ng-dirty ng-valid ng-touched" required>

                <owl-date-time
                  autoClose
                  dataType="string"
                  pickerMode="dialog"
                  #enrollmentClosesODT>
                </owl-date-time>

                <div class="buttons">
                  <button type="button"><i class="icon ion-ios-calendar"></i></button>
                </div>

              </div>
              <small class="text-danger" *ngIf="enrollmentCloses.invalid">This date is invalid</small>
            </div>

            <!-- Enrollment Max Capacity -->
            <div class="form-group group d-flex flex-column col-sm-2"
                 [ngClass]="{
                 'error' : (maxCap.invalid && (maxCap.dirty || maxCap.touched)) }">
              <label for="maxCap">Capacity</label>
              <input fullwidth id="maxCap" name="maxCap" nbinput formControlName="maxCap" type="number" ng-reflect-name="maxCap" class="input-full-width input-md ng-dirty ng-valid ng-touched" required>
              <small class="text-danger" *ngIf="maxCap.hasError('required') && (maxCap.dirty || maxCap.touched)">Capacity is required</small>
              <small class="text-danger" *ngIf="maxCap.hasError('min') && (maxCap.dirty || maxCap.touched)">Capacity cannot be less than 1!</small>
            </div>
          </div>

          <hr>

          <!-- Note -->
          <div class="form-group group d-flex flex-column">
            <label for="title">Match Note</label>
            <textarea fullwidth name="note" nbinput id="note" rows="2" formControlName="note" ng-reflect-name="note" class="input-full-width input-md ng-dirty ng-valid ng-touched"></textarea>
          </div>

          <hr>

          <!-- TODO: Only Admin -->
          <section>
            <div class="row">

              <!-- Created At -->
              <div class="form-group group d-flex flex-column col-sm-6"
                   [ngClass]="{ 'error' : createdAt.invalid && (createdAt.dirty || createdAt.touched), 'disabled' : !date.value }">
                <label for="enrollmentCloses">Created At</label>
                <div class="calendar">

                  <input
                    [owlDateTimeTrigger]="createdAtODT"
                    [owlDateTime]="createdAtODT"
                    [max]="now"
                    id="createdAt" name="createdAt" formControlName="createdAt" ng-reflect-name="createdAt"
                    class="input-full-width input-md ng-dirty ng-valid ng-touched" required>

                  <owl-date-time
                    autoClose
                    dataType="string"
                    pickerMode="dialog"
                    #createdAtODT>
                  </owl-date-time>

                  <div class="buttons">
                    <button type="button"><i class="icon ion-ios-calendar"></i></button>
                  </div>

                </div>
                <small class="text-danger" *ngIf="createdAt.invalid">This date is invalid</small>
              </div>

              <!-- Created By -->
              <div class="form-group group d-flex flex-column col-sm-6"
                   [ngClass]="{ 'error' : createdBy.invalid && (createdBy.dirty || createdBy.touched) }">
                <label for="title">Created By</label>
                <ng-select
                  #createdByID
                  [multiple]="false"
                  [closeOnSelect]="true"
                  bindLabel="name"
                  bindValue="_id"
                  id="createdBy" name="createdBy" formControlName="createdBy" ng-reflect-name="createdBy" class="ng-select-input-custom flex-grow-1">
                </ng-select>
                <small class="text-danger" *ngIf="createdBy.hasError('required') && (createdBy.dirty || createdBy.touched)">Created By is required</small>
              </div>

            </div>

            <div class="row">

              <!-- Updated At -->
              <div class="form-group group d-flex flex-column col-sm-6"
                   [ngClass]="{ 'error' : updatedAt.invalid && (updatedAt.dirty || updatedAt.touched), 'disabled' : !date.value }">
                <label for="enrollmentCloses">Updated At</label>
                <div class="calendar">

                  <input
                    [owlDateTimeTrigger]="updatedAtODT"
                    [owlDateTime]="updatedAtODT"
                    [min]="createdAt.value"
                    [max]="now"
                    id="updatedAt" name="updatedAt" formControlName="updatedAt" ng-reflect-name="updatedAt"
                    class="input-full-width input-md ng-dirty ng-valid ng-touched" required>

                  <owl-date-time
                    autoClose
                    dataType="string"
                    pickerMode="dialog"
                    #updatedAtODT>
                  </owl-date-time>

                  <div class="buttons">
                    <button type="button"><i class="icon ion-ios-calendar"></i></button>
                  </div>

                </div>
                <small class="text-danger" *ngIf="updatedAt.invalid">This date is invalid</small>
              </div>

              <!-- Updated By -->
              <div class="form-group group d-flex flex-column col-sm-6"
                   [ngClass]="{ 'error' : updatedBy.invalid && (updatedBy.dirty || updatedBy.touched) }">
                <label for="title">Updated By</label>
                <ng-select
                  #updatedByID
                  [multiple]="false"
                  [closeOnSelect]="true"
                  bindLabel="name"
                  bindValue="_id"
                  id="updatedBy" name="updatedBy" formControlName="updatedBy" ng-reflect-name="updatedBy" class="ng-select-input-custom flex-grow-1">
                </ng-select>
                <small class="text-danger" *ngIf="updatedBy.hasError('required') && (updatedBy.dirty || updatedBy.touched)">Updated By is required</small>
              </div>

            </div>
          </section>

          <hr>

          <!-- Submit -->
          <div class="form-group mt-2">
            <button nbbutton class="col-sm-12 p-3" [ngClass]="{'btn-disabled': !form.valid || isSame() }" aria-disabled="false" (click)="submitForm(form.value)">Save Changes</button>
          </div>

        </form>
      </nb-card-body>

    </nb-card>
  </div>
</div>
